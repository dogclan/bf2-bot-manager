version: '3.7'
services:
  bot:
    build: .
    restart: always

    command: ["./wait-for-it.sh", "redis:6379", "--timeout=60", "--", "node", "dist/index.js"]

    volumes:
      - ${PWD}/resources:/usr/src/app/resources
      - ${PWD}/config.yaml:/usr/src/app/config.yaml
    environment:
      - LOG_LEVEL=info
      - MOUNTED_RESOURCES=1 # Resources folder will be mounted into the container, keep this set to 1
      - TOKEN=your_discord_bot_token
      - REDIS_URL=redis://:the_redis_password@redis
    extra_hosts:
      - "gpcm.gamespy.com:127.0.0.1"
      - "gpsp.gamespy.com:127.0.0.1"
      - "battlefield2.available.gamespy.com:127.0.0.1"
    depends_on:
      - redis

  redis:
    image: "redis:alpine"
    restart: always

    command: redis-server /etc/redis/redis.conf --requirepass the_redis_password

    volumes:
      - redis:/data
      - $PWD/redis.conf:/etc/redis/redis.conf

    environment:
      - REDIS_REPLICATION_MODE=master

volumes:
  redis:
